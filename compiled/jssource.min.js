function setDiff(t) {
    ref = {
        120: "Easiest",
        100: "Easy",
        80: "Normal",
        60: "Hard",
        40: "Harder",
        20: "Unfair"
    }, startingDifficulty = ref[t], difficulty = t, goodDiff = (start = t) / 20, $("#diffLevel").html(startingDifficulty), 
    $("#setup").hide(), $("table").show(), resetGame(), startTime = new Date().getTime();
}

function newTask() {
    setAll(), setOne(difficulty), updateText(difficulty);
}

function resetGame() {
    xSize = 4, ySize = 4, tagCount = 0;
    var t = start;
    setAll(), setOne(t), updateText(t);
}

function updateText(t) {
    (start - t) / goodDiff + 1 > 20 ? $("#level").html("Winner winner, chicken dinner!") : $("#level").html((start - t) / goodDiff + 1), 
    t <= 0 && (win(), difficulty = start);
}

function right() {
    $("body").addClass("right"), $("#levelDiv").addClass("right"), setTimeout(function() {
        $("body").removeClass("right"), $("#levelDiv").removeClass("right");
    }, 500);
}

function wrong() {
    $("body").addClass("wrong"), $("#levelDiv").addClass("wrong"), setTimeout(function() {
        $("body").removeClass("wrong"), $("#levelDiv").removeClass("wrong");
    }, 500);
}

function tag(t) {
    tagCount += 1, $(t).css("background-color") == "rgb(" + SR + ", " + SG + ", " + SB + ")" ? (difficulty < start - goodDiff ? difficulty += 2 * goodDiff : difficulty < start && (difficulty += goodDiff), 
    wrong()) : (difficulty -= goodDiff, right()), newTask();
}

function refresh() {
    $("table").hide(), $("#setup").show(), $("#winDiv").css("visibility", "hidden"), 
    $("#level").text("1"), $("#diffLevel").text("Normal");
}

function win() {
    var t = new Date().getTime(), i = new Date(t - startTime), e = 60 * i.getHours() + i.getMinutes() + ":" + ("0" + i.getSeconds()).slice(-2) + "." + i.getMilliseconds();
    $("#winMessage").html("You have beaten painterly on " + startingDifficulty + " difficulty!<br/>It took you " + e + " and " + tagCount + " clicks!"), 
    $("#winDiv").css("visibility", "visible"), $("table").hide();
}

function setOne(t) {
    var i = Math.round(Math.random() * (xSize * ySize - 1));
    t > start ? t = start : t < 1 && (t = 1), $(".tile").each(function(e) {
        if (i == e) {
            var n = Math.random();
            n < .33 ? R = plusOrMinus(R, t) : n < .66 ? G = plusOrMinus(G, t) : B = plusOrMinus(B, t), 
            $(this).css("background-color", "RGB(" + R + "," + G + "," + B + ")");
        }
    });
}

function plusOrMinus(t, i) {
    var e;
    return Math.random() > .5 ? (e = t - i) < 0 && (e = t + i) : (e = t + i) > 255 && (e = t - i), 
    e;
}

function setAll() {
    R = Math.round(255 * Math.random()), G = Math.round(255 * Math.random()), B = Math.round(255 * Math.random()), 
    SR = R, SG = G, SB = B, $(".tile").each(function(t) {
        $(this).css("background-color", "RGB(" + R + "," + G + "," + B + ")");
    });
}

function makeGrid(t, i) {
    var e = function(t) {
        return $("<tr/>").append(i.times(function(t) {
            return $("<td/>").html('<div class="tile" onclick="tag(this);"></div>');
        }));
    };
    return $("<table/>").append(t.times(e));
}

function cheat() {
    $(".tile").each(function(t) {
        "rgb(" + SR + ", " + SG + ", " + SB + ")" != $(this).css("background-color") && $(this).click();
    });
}

var start = 80, goodDiff = start / 20, xSize = 4, ySize = 4, R, G, B, SR, SG, SB, startTime, endTime, startingDifficulty, tagCount, difficulty = start;

$(function() {
    $("#box").append(makeGrid(xSize, ySize)), newTask();
}), Number.prototype.times = function(t) {
    for (var i = [], e = 0; e < this; e++) i.push(t(e));
    return i;
};